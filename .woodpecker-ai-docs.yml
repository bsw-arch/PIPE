---
# BSW AI Documentation Bots CI/CD Pipeline
# Specialized pipeline for AI documentation services

when:
  - event: push
    branch: [main, develop, feature/bsw-arch-*]
    path:
      - "src/applications/ai-documentation-bots/**"
      - "src/applications/kamerbrieven/**"
      - "src/applications/togaf-phase-e-ml-pipeline/**"

variables:
  - &python_image 'cgr.dev/chainguard/python:latest'

pipeline:
  # Security scan for AI services
  ai-security-scan:
    image: *python_image
    commands:
      - echo "ğŸ” Running AI services security scan..."
      - python3 -m py_compile src/applications/ai-documentation-bots/*.py
      - echo "ğŸ”’ Checking for hardcoded credentials..."
      - if grep -r "token.*=" src/applications/ai-documentation-bots/ --include="*.py"; then echo "âŒ Found hardcoded tokens" && exit 1; else echo "âœ… No hardcoded credentials"; fi
      - echo "âœ… AI services security scan passed"

  # Test AI documentation generation
  test-ai-docs:
    image: *python_image
    commands:
      - echo "ğŸ§ª Testing AI documentation services..."
      - cd src/applications/ai-documentation-bots
      - python3 -c "
        import axis_documentation_bot
        import pipe_documentation_bot
        import iv_documentation_bot
        print('âœ… All AI documentation bots import successfully')
        "
      - echo "ğŸ¯ Testing documentation generation logic..."
      - python3 -c "
        from axis_documentation_bot import AXISDocumentationBot
        bot = AXISDocumentationBot()
        print('âœ… AXIS bot initialized successfully - 13 organizations supported')
        "
      - echo "âœ… AI documentation tests passed"

  # Test Phase E ML Pipeline
  test-phase-e:
    image: *python_image
    commands:
      - echo "ğŸ§ª Testing TOGAF Phase E ML Pipeline..."
      - cd src/applications/togaf-phase-e-ml-pipeline
      - python3 -c "
        import togaf_phase_e_ml_pipeline
        print('âœ… Phase E ML Pipeline imports successfully')
        "
      - echo "âœ… Phase E tests passed"

  # Test Kamerbrieven Framework
  test-kamerbrieven:
    image: *python_image
    commands:
      - echo "ğŸ§ª Testing Kamerbrieven Framework..."
      - cd src/applications/kamerbrieven
      - python3 -c "
        import opentk_integration
        import multi_ministry_framework
        print('âœ… Kamerbrieven components import successfully')
        "
      - echo "âœ… Kamerbrieven tests passed"

  # Build status notification
  build-complete:
    image: *python_image
    commands:
      - echo "ğŸ‰ BSW AI Documentation Services CI/CD Pipeline Complete"
      - echo "âœ… Security scan: PASSED"
      - echo "âœ… AI documentation tests: PASSED"
      - echo "âœ… Phase E ML Pipeline tests: PASSED"
      - echo "âœ… Kamerbrieven Framework tests: PASSED"
      - echo "ğŸš€ Ready for deployment to Bot organizations"

  # Deployment trigger (manual for now)
  deploy-notification:
    image: *python_image
    commands:
      - echo "ğŸ“¦ Deployment ready for:"
      - echo "   ğŸ¤– AXIS Documentation Bot (port 4601)"
      - echo "   ğŸ¤– PIPE Documentation Bot (port 4602)"
      - echo "   ğŸ¤– IV Documentation Bot (port 4603)"
      - echo "   ğŸ“Š Phase E ML Pipeline (port 4451)"
      - echo "   ğŸ“‹ Kamerbrieven Framework (port 3114)"
      - echo "ğŸ”— Bot Organization Integration:"
      - echo "   ğŸ“¦ PIPE-Bots/pipe-docs-bot"
      - echo "   ğŸ§  IV-Bots/iv-docs-ai"
      - echo "   ğŸ›ï¸ AXIS-Bots/axis-docs-bot"
      - echo "   ğŸŒ ECO-Bots/ECO-docs-bot"
    when:
      - event: push
        branch: [main, develop]