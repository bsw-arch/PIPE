# Default values for pipe-artifact-bot Helm chart
# ===========================================

global:
  registry: localhost:5000
  tag: latest
  pullPolicy: IfNotPresent

# Image configurations
images:
  taskBot:
    repository: pipe-artifact-bot
    tag: latest
  taskScheduler:
    repository: axis-task-scheduler
    tag: latest
  taskExecutor:
    repository: axis-task-executor
    tag: latest

# Replica configuration
replicaCount:
  taskBot: 1
  taskScheduler: 1
  taskExecutor: 3  # Horizontal scaling for execution

# Resource limits (ultra-minimal containers!)
resources:
  taskBot:
    requests:
      memory: "32Mi"
      cpu: "100m"
    limits:
      memory: "64Mi"
      cpu: "500m"
  taskScheduler:
    requests:
      memory: "32Mi"
      cpu: "50m"
    limits:
      memory: "64Mi"
      cpu: "250m"
  taskExecutor:
    requests:
      memory: "32Mi"
      cpu: "100m"
    limits:
      memory: "64Mi"
      cpu: "500m"

# OpenBao secrets integration
openbao:
  enabled: true
  address: "http://localhost:8200"
  authMethod: "kubernetes"
  role: "pipe-artifact-bot"
  secretPath: "axis-bots/task-bot"

  # Vault Agent Injector annotations
  annotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: "pipe-artifact-bot"
    vault.hashicorp.com/agent-inject-secret-config: "axis-bots/task-bot"

# Service configuration
service:
  type: ClusterIP
  ports:
    taskBot: 8080
    taskScheduler: 8081
    taskExecutor: 8082

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
  hosts:
    - host: pipe-artifact-bot.local
      paths:
        - path: /
          pathType: Prefix
          service: task-bot
  tls: []

# Security context (non-root!)
securityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  fsGroup: 65532
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Pod security
podSecurityContext:
  seccompProfile:
    type: RuntimeDefault

# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Persistence
persistence:
  enabled: true
  storageClass: "local-path"
  accessMode: ReadWriteOnce
  size: 1Gi
  mountPath: /app/data

# Configuration
config:
  # PIPE ecosystem integration
  keragrUrl: "http://meta-keragr:3108"
  coordinationUrl: "http://axis-coordination:3111"

  # Operational settings
  logLevel: "INFO"
  autonomous: true
  learningEnabled: true

  # TOGAF compliance
  togafCompliance: true
  auditLogging: true

# Environment-specific configs (override in values/<env>.yaml)
environment: production

# Monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
  prometheusRule:
    enabled: true

# Logging
logging:
  enabled: true
  format: "json"
  loki:
    enabled: true
    url: "http://loki:3100"

# Network policies
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: axis-bots
  egress:
    - to:
      - namespaceSelector:
          matchLabels:
            name: axis-bots
    - to:  # Allow META-KERAGR access
      - podSelector:
          matchLabels:
            app: meta-keragr

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Horizontal Pod Autoscaler
autoscaling:
  enabled: false
  taskExecutor:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Node affinity
affinity: {}

# Tolerations
tolerations: []

# Node selector
nodeSelector: {}

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: "pipe-artifact-bot"

# RBAC
rbac:
  create: true
